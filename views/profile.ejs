<%- include head.ejs %>
<div id="home-box">
	<h1 class="splash-head">Hello, <%= user.userName %></h1>
	
</div>
    <div id="main-content">
    <% if(message){ %>
		<h3 class="alert"><%= message %></h3>
	<% } %> 
	<div class="pure-g">
		<div class="pure-u-1 pure-u-md-1-3 alerts-container">
				<div class="headerBox" id="alerts-header">
					<h1>Alerts</h1> <hr class="header-hr" id="alerts-hr"/>
				</div>
				<% console.log("num alerts: " + user.alerts.length); %>
				<% for(i = 0; i < user.alerts.length; i++){ 
					alert = user.alerts[i]; %>
					<h3 class="splash-subhead">
						<%= alert.message %>
						<br/>
						<br/>
						<button class="pure-button alert-delete" ><i class="fa fa-trash-o fa-lg"></i></button>
						<button class="pure-button alert-goto" ><i class="fa fa-arrow-circle-right fa-lg"></i></button>
					</h3>
				<% } %>
				
		</div>
		<div class="pure-u-1 pure-u-md-2-3">
			<div class="headerBox" id="listings-header">
				<h1>My Listings</h1><hr class="header-hr" id="listings-hr"/>
			</div>
			<div class="scroll-table-out pure-u-5-5 listings" >
				<% if(user.inventory.length > 0){ %>
					<% for(var i=0; i<user.inventory.length; i++) { 
						if(user.inventory[i].status = "available"){   
						l = user.inventory[i]; %>	
						<div class="pure-g l-complete">
							<div class="pure-u-1-6 l-price">
								<p>$<%= l.price %></p>
							</div>
							<div class="pure-u-2-3 l-main">
								<h2><%= l.book.name %></h2>
								
								<div class="pure-g listing-grid">
									<div class="pure-u-1-3">
										<p>v.<%= l.edition %></p>
									</div>
									<div class="pure-u-1-3">
										<p><%= l.condition %></p>
									</div>
									<div class="pure-u-1-3">
										<p class="clickable">more &#9660;</p>
									</div>
								</div>
							</div>
							<div class="pure-u-1-6 l-button">
								<p>
									<i class="fa fa-trash-o fa-lg"></i>
								</p>
							</div>
						</div>
						<% } %>
					<% } %>
				<% } %>
				<div class="section-footer">
					<a href="/listing/new"><button class="pure-button button-large" id="listing-button"><i class="fa fa-plus-square fa-lg"></i> Add a Listing </button></a>
				</div>
			
			</div>
			<div class="headerBox" id="trans-header">
				<h1>Transactions</h1><hr class="header-hr" id="transactions-hr"/>
			</div>
			<div class="transactions" id="transactions">
			<% for(var i=0; i < user.transactions.length; i++) { %>
				<%  transID = user.transactions[i]._id;
					transIDSend = "s" + transID;
					transIDChat = "c" + transID;
				 %>

				<div class="transaction">
					<div>
						<h3 class="splash-subhead trans-head">
							<% 
								isBuyer = user.transactions[i].buyer;
								role = "Selling";
								if(isBuyer == user.userName) role = "Buying";
							%>
							<%= role %> <%= user.transactions[i].listing.book.name %>
							for $<%= user.transactions[i].listing.price %>
						<br/><br/>
						<button class="pure-button chat" onclick="toggleChat('<%= transIDChat %>', '<%= transIDSend%>')">
							Chat with
								<%
								if (role == "Buying"){
									%> 
							<%= user.transactions[i].seller%>
							 <% }else{ %> 
							 <%= user.transactions[i].buyer%>
							 <% } %>
						</button>
						</h3>
					</div>
					<div class="tContent" id="<%= transIDChat%>">
						<div class="interaction">
					        <div class="chat-log" id='<%= user.transactions[i]._id%>'>
					        	<% if(user.transactions[i].transConv){
					        		for(j = 0; j < user.transactions[i].transConv.length; j++){ 
					        			conv = user.transactions[i].transConv[j]%>
					        		<h3 class='<%= conv.mType%>'><%= conv.mContent %></h3>

					        		<% if(conv.mType == "meetupM"){ %>
						        		<form class="acceptMeet">
						        			<input type="hidden" class="pure-input-2-3 message" name="trans" value='<%= user.transactions[i]._id%>'>
						        			<button class="pure-button">Accept</button>
						        		</form>
						        	<% } %>

					        	<% }} %>

				



					        </div>
							<!-- <form class="pure-form sendM" action="/transaction/addM" method="post"> -->
							<form class="pure-form sendM">
								<fieldset id="<%= transIDSend%>">
									<input type="text" class="pure-input-2-3 message" name="message">
									<input type="hidden" class="pure-input-2-3 message" name="trans" value='<%= user.transactions[i]._id%>'>
									<button class="pure-button">Send</button>
								</fieldset>
							</form>

							<!-- <button type="submit" class="pure-button message">Set meetup</button> -->
										


							<form class="pure-form pure-form-aligned setLT" action="/transaction/addLT" method="post">
								<fieldset class="pure-from-fieldset">
									<div class="pure-control-group">
										<label for="name">Location</label>
										<input type="text" class="form-control" name="location"/>
									</div>
									
									<div class="pure-control-group">
										<label for="price">Time</label>
										<input id="basicExample" type="text" class="time" name="time" />
									</div>
									
									<div class="pure-control-group">
										<label for="time">Day</label>
										
										<input type="date" class="form-control datePic" name="day"/>
										<script>
							                $(function() {
							                    $('#basicExample').timepicker();
							                 
							                });
							            </script>
									</div>	
									<input type="hidden" class="pure-input-2-3 message" name="trans" value='<%= user.transactions[i]._id%>'>
									<button type="submit" class="pure-button" >Suggest</button>
								</fieldset>			
							</form>
						</div>
					</div>
				</div>
			<% } %>
			<div class="section-footer">
				<a href="/listing/search"><button class="pure-button button-large" id="search-button"><i class="fa fa-plus-square fa-lg"></i> Buy a Book </button></a>
			</div>
			</div>

		</div>
	</div>
	</div>
<!-- </div>
 -->



<script type="text/javascript" src="/javascripts/vendor/jquery-ui/js/jquery-1.8.3.js" ></script>
<script type="text/javascript" src="/javascripts/vendor/jquery-ui/js/jquery-ui-1.9.2.min.js"></script>
 <script type="text/javascript">
	$(function(){
		$('.tContent').hide();
		$('.setLT').hide();
	})

 </script>



</body>


	<link href="/javascripts/vendor/jquery-ui/css/custom-theme/jquery-ui-1.9.2.css" rel="stylesheet">
	<script type="text/javascript" src="/javascripts/index.js"></script>
	<link rel="stylesheet" href="/stylesheets/style.css"/>


	<script type="text/javascript" src="/javascripts/jquery.timepicker.js"></script>
  	<link rel="stylesheet" type="text/css" href="/stylesheets/jquery.timepicker.css" />

  	<script type="text/javascript" src="/javascripts/bootstrap-datepicker.js"></script>
  	<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap-datepicker.css" />



  	<link rel="stylesheet" type="text/css" href="/stylesheets/jquery.datetimepicker.css"/ >
  	<script src="/javascripts/jquery.datetimepicker.js"></script>

</html>
